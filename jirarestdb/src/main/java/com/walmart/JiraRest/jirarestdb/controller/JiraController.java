package com.walmart.JiraRest.jirarestdb.controller;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.Collection;
import java.util.List;

import org.json.CDL;
import org.json.JSONArray;
import org.json.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.walmart.JiraRest.jirarestdb.domain.User;
import com.walmart.JiraRest.jirarestdb.service.JiraService;
import com.walmart.JiraRest.jirarestdb.service.UserService;


@RestController
public class JiraController {
	
	private UserService userService;

    public JiraController(UserService userService) {
        this.userService = userService;
    }
    
    @Autowired
    JiraService jiraService;
	
    

    @RequestMapping(value = "/list/{key}", produces = "application/json")
    public Iterable<User> list(@PathVariable String key) throws ParseException { //
    	String jSessionID = jiraService.apiCall();
    	String str = jiraService.getJsonData(jSessionID, key);
//    	String str ="[{\"id\":7330592,\"key\":\"CAREMAIL-7806\",\"fields\":{\"summary\":\"Re-run the jobs impacted by 10.227.210.126 VM replacement\",\"created\":\"2020-06-30T16:04:53.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"vbalag2\",\"emailAddress\":\"VBalaganur@walmart.com\",\"displayName\":\"Veeresh Balaganur - Vendor\"},\"assignee\":{\"key\":\"vbalag2\",\"emailAddress\":\"VBalaganur@walmart.com\",\"displayName\":\"Veeresh Balaganur - Vendor\"}}},{\"id\":7330776,\"key\":\"CAREMAIL-7807\",\"fields\":{\"summary\":\"Write audit log to Kafka topic from Spark\",\"created\":\"2020-06-30T16:05:00.000-0700\",\"status\":{\"name\":\"Work in Progress\"},\"reporter\":{\"key\":\"mvu15\",\"emailAddress\":\"MVu@walmartlabs.com\",\"displayName\":\"Mac Vu\"},\"assignee\":{\"key\":\"s0l0194\",\"emailAddress\":\"SLokande@walmartlabs.com\",\"displayName\":\"Shamitha Lokande\"}}},{\"id\":7330785,\"key\":\"CAREMAIL-7808\",\"fields\":{\"summary\":\"Manually close 276 access request and monitor them if they are not closed\",\"created\":\"2020-06-30T16:07:42.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"},\"assignee\":{\"key\":\"vn0mzk5\",\"emailAddress\":\"Sravan.Vangala@walmartlabs.com\",\"displayName\":\"Sravan Vangala\"}}},{\"id\":7331060,\"key\":\"CAREMAIL-7809\",\"fields\":{\"summary\":\"Explore REST Api Shared by Jira team to capture Jira details automatically\",\"created\":\"2020-06-30T16:46:31.000-0700\",\"status\":{\"name\":\"Work in Progress\"},\"reporter\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"},\"assignee\":{\"key\":\"vn0q2v3\",\"emailAddress\":\"Ashish.Rajbhandari@walmart.com\",\"displayName\":\"Ashish Rajbhandari - Vendor\"}}},{\"id\":7331419,\"key\":\"CAREMAIL-7810\",\"fields\":{\"summary\":\"Customer data process deployment to GCP - dim_customer_data_load.sh - Production\",\"created\":\"2020-06-30T17:41:32.000-0700\",\"status\":{\"name\":\"Work in Progress\"},\"reporter\":{\"key\":\"asingh\",\"emailAddress\":\"ArjunSingh@walmartlabs.com\",\"displayName\":\"Arjun Bir Singh\"},\"assignee\":{\"key\":\"nramnan\",\"emailAddress\":\"NRamnani@walmart.com\",\"displayName\":\"Neha Ramnani - Vendor\"}}},{\"id\":7331423,\"key\":\"CAREMAIL-7811\",\"fields\":{\"summary\":\"Customer data process deployment to GCP - subscription_data_load.sh - Production\",\"created\":\"2020-06-30T17:43:33.000-0700\",\"status\":{\"name\":\"Work in Progress\"},\"reporter\":{\"key\":\"asingh\",\"emailAddress\":\"ArjunSingh@walmartlabs.com\",\"displayName\":\"Arjun Bir Singh\"},\"assignee\":{\"key\":\"nramnan\",\"emailAddress\":\"NRamnani@walmart.com\",\"displayName\":\"Neha Ramnani - Vendor\"}}},{\"id\":7331425,\"key\":\"CAREMAIL-7812\",\"fields\":{\"summary\":\" Customer data process deployment to GCP - subscription_survey_data_load.sh - Production\",\"created\":\"2020-06-30T17:44:41.000-0700\",\"status\":{\"name\":\"Work in Progress\"},\"reporter\":{\"key\":\"asingh\",\"emailAddress\":\"ArjunSingh@walmartlabs.com\",\"displayName\":\"Arjun Bir Singh\"},\"assignee\":{\"key\":\"nramnan\",\"emailAddress\":\"NRamnani@walmart.com\",\"displayName\":\"Neha Ramnani - Vendor\"}}},{\"id\":7331427,\"key\":\"CAREMAIL-7813\",\"fields\":{\"summary\":\"Customer data process deployment to GCP - eligible_customer_load.sh - Production\",\"created\":\"2020-06-30T17:45:33.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"asingh\",\"emailAddress\":\"ArjunSingh@walmartlabs.com\",\"displayName\":\"Arjun Bir Singh\"},\"assignee\":{\"key\":\"vbalag2\",\"emailAddress\":\"VBalaganur@walmart.com\",\"displayName\":\"Veeresh Balaganur - Vendor\"}}},{\"id\":7331433,\"key\":\"CAREMAIL-7814\",\"fields\":{\"summary\":\"Customer data process deployment to GCP - hive_crm_cust_sales_agg_daily.sh - Production\",\"created\":\"2020-06-30T17:46:41.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"asingh\",\"emailAddress\":\"ArjunSingh@walmartlabs.com\",\"displayName\":\"Arjun Bir Singh\"},\"assignee\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"}}},{\"id\":7331436,\"key\":\"CAREMAIL-7815\",\"fields\":{\"summary\":\"Customer data process deployment to GCP - cust_opens_clicks_load_incremental.sh - Production\",\"created\":\"2020-06-30T17:47:29.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"asingh\",\"emailAddress\":\"ArjunSingh@walmartlabs.com\",\"displayName\":\"Arjun Bir Singh\"},\"assignee\":{\"key\":\"vbalag2\",\"emailAddress\":\"VBalaganur@walmart.com\",\"displayName\":\"Veeresh Balaganur - Vendor\"}}},{\"id\":7331438,\"key\":\"CAREMAIL-7816\",\"fields\":{\"summary\":\"Customer data process deployment to GCP - get_push_optout.sh - Production\",\"created\":\"2020-06-30T17:48:18.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"asingh\",\"emailAddress\":\"ArjunSingh@walmartlabs.com\",\"displayName\":\"Arjun Bir Singh\"},\"assignee\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"}}},{\"id\":7331445,\"key\":\"CAREMAIL-7817\",\"fields\":{\"summary\":\"CRM C*/Hive/GCP password change required for [Dev, Prod] Preference Center Cassandra DB\",\"created\":\"2020-06-30T17:55:34.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"r0z00t0\",\"emailAddress\":\"Raymond.Su@walmartlabs.com\",\"displayName\":\"Raymond Su\"},\"assignee\":{\"key\":\"k0m02vb\",\"emailAddress\":\"Khushboo.Mutha@walmartlabs.com\",\"displayName\":\"Khushboo Mutha\"}}},{\"id\":7331467,\"key\":\"CAREMAIL-7818\",\"fields\":{\"summary\":\"Inbound CLM password change required for [Dev, Prod] Preference Center Cassandra DB\",\"created\":\"2020-06-30T18:12:13.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"r0z00t0\",\"emailAddress\":\"Raymond.Su@walmartlabs.com\",\"displayName\":\"Raymond Su\"},\"assignee\":{\"key\":\"vn0mzk5\",\"emailAddress\":\"Sravan.Vangala@walmartlabs.com\",\"displayName\":\"Sravan Vangala\"}}},{\"id\":7331471,\"key\":\"CAREMAIL-7819\",\"fields\":{\"summary\":\"CLM-> Braze password change required for [Dev, Prod] Preference Center Cassandra DB\",\"created\":\"2020-06-30T18:15:51.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"r0z00t0\",\"emailAddress\":\"Raymond.Su@walmartlabs.com\",\"displayName\":\"Raymond Su\"},\"assignee\":{\"key\":\"s0l0194\",\"emailAddress\":\"SLokande@walmartlabs.com\",\"displayName\":\"Shamitha Lokande\"}}},{\"id\":7332518,\"key\":\"CAREMAIL-7820\",\"fields\":{\"summary\":\"Production Support\",\"created\":\"2020-06-30T21:34:52.000-0700\",\"status\":{\"name\":\"Work in Progress\"},\"reporter\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"},\"assignee\":{\"key\":\"nramnan\",\"emailAddress\":\"NRamnani@walmart.com\",\"displayName\":\"Neha Ramnani - Vendor\"}}},{\"id\":7332534,\"key\":\"CAREMAIL-7821\",\"fields\":{\"summary\":\"Production Support\",\"created\":\"2020-06-30T21:41:54.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"},\"assignee\":{\"key\":\"amuthu1\",\"emailAddress\":\"AMuthuvel@walmart.com\",\"displayName\":\"Abiramavalli Muthuvel\"}}},{\"id\":7332546,\"key\":\"CAREMAIL-7822\",\"fields\":{\"summary\":\"Production Support\",\"created\":\"2020-06-30T21:47:54.000-0700\",\"status\":{\"name\":\"Work in Progress\"},\"reporter\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"},\"assignee\":{\"key\":\"vbalag2\",\"emailAddress\":\"VBalaganur@walmart.com\",\"displayName\":\"Veeresh Balaganur - Vendor\"}}},{\"id\":7332550,\"key\":\"CAREMAIL-7823\",\"fields\":{\"summary\":\"Production Support\",\"created\":\"2020-06-30T21:51:55.000-0700\",\"status\":{\"name\":\"Work in Progress\"},\"reporter\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"},\"assignee\":{\"key\":\"nalimal\",\"emailAddress\":\"NAlimallick@walmartlabs.com\",\"displayName\":\"Neakbar Ali Mallick - Vendor\"}}},{\"id\":7332567,\"key\":\"CAREMAIL-7824\",\"fields\":{\"summary\":\"Production Support\",\"created\":\"2020-06-30T22:00:40.000-0700\",\"status\":{\"name\":\"Work in Progress\"},\"reporter\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"},\"assignee\":{\"key\":\"ariyaz\",\"emailAddress\":\"ARiyaz@walmart.com\",\"displayName\":\"Atheeq Riyaz - Vendor\"}}},{\"id\":7339685,\"key\":\"CAREMAIL-7825\",\"fields\":{\"summary\":\"Password change for Prod CRM Cassandra DB\",\"created\":\"2020-07-01T11:57:53.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"asingh\",\"emailAddress\":\"ArjunSingh@walmartlabs.com\",\"displayName\":\"Arjun Bir Singh\"},\"assignee\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"}}},{\"id\":7341316,\"key\":\"CAREMAIL-7826\",\"fields\":{\"summary\":\"Deploy Push preferences sync to braze in production\",\"created\":\"2020-07-01T14:20:29.000-0700\",\"status\":{\"name\":\"Work in Progress\"},\"reporter\":{\"key\":\"s0l0194\",\"emailAddress\":\"SLokande@walmartlabs.com\",\"displayName\":\"Shamitha Lokande\"},\"assignee\":{\"key\":\"s0l0194\",\"emailAddress\":\"SLokande@walmartlabs.com\",\"displayName\":\"Shamitha Lokande\"}}},{\"id\":7342281,\"key\":\"CAREMAIL-7827\",\"fields\":{\"summary\":\"Targeting_crm_reports.crm_email_orders_daily no customer information \",\"created\":\"2020-07-01T15:30:20.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"vn04joo\",\"emailAddress\":\"Ekta.Kapadia@walmart.com\",\"displayName\":\"Ekta Kapadia - Vendor\"},\"assignee\":{\"key\":\"vbalag2\",\"emailAddress\":\"VBalaganur@walmart.com\",\"displayName\":\"Veeresh Balaganur - Vendor\"}}},{\"id\":7343310,\"key\":\"CAREMAIL-7828\",\"fields\":{\"summary\":\"Mark Certificate \\\"qa-comms-int-services.wal-mart.com\\\" as obsolete\",\"created\":\"2020-07-01T17:36:28.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"asingh\",\"emailAddress\":\"ArjunSingh@walmartlabs.com\",\"displayName\":\"Arjun Bir Singh\"},\"assignee\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"}}},{\"id\":7350611,\"key\":\"CAREMAIL-7829\",\"fields\":{\"summary\":\"NML EMail 1 and Email 2 are not live in Braze\",\"created\":\"2020-07-02T09:50:43.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"vbalag2\",\"emailAddress\":\"VBalaganur@walmart.com\",\"displayName\":\"Veeresh Balaganur - Vendor\"},\"assignee\":{\"key\":\"vn502ln\",\"emailAddress\":\"Paul.Chumak@walmart.com\",\"displayName\":\"Paul Chumak - Vendor\"}}},{\"id\":7351183,\"key\":\"CAREMAIL-7831\",\"fields\":{\"summary\":\"Regarding campaign sends  on 06/26\",\"created\":\"2020-07-02T10:38:58.000-0700\",\"status\":{\"name\":\"Ready for Review\"},\"reporter\":{\"key\":\"nramnan\",\"emailAddress\":\"NRamnani@walmart.com\",\"displayName\":\"Neha Ramnani - Vendor\"},\"assignee\":{\"key\":\"nramnan\",\"emailAddress\":\"NRamnani@walmart.com\",\"displayName\":\"Neha Ramnani - Vendor\"}}},{\"id\":7351232,\"key\":\"CAREMAIL-7830\",\"fields\":{\"summary\":\"Mark Certificate \\\"comms-int-services.wal-mart.com\\\" as obsolete\",\"created\":\"2020-07-02T10:37:39.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"asingh\",\"emailAddress\":\"ArjunSingh@walmartlabs.com\",\"displayName\":\"Arjun Bir Singh\"},\"assignee\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"}}},{\"id\":7352508,\"key\":\"CAREMAIL-7832\",\"fields\":{\"summary\":\"Test Push Story IOS in QA Build\",\"created\":\"2020-07-02T12:10:37.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"},\"assignee\":{\"key\":\"vbalag2\",\"emailAddress\":\"VBalaganur@walmart.com\",\"displayName\":\"Veeresh Balaganur - Vendor\"}}},{\"id\":7371005,\"key\":\"CAREMAIL-7833\",\"fields\":{\"summary\":\"Discrepancy between CRM and WMX impressions count\",\"created\":\"2020-07-06T10:27:30.000-0700\",\"status\":{\"name\":\"Ready for Review\"},\"reporter\":{\"key\":\"z0g00iz\",\"emailAddress\":\"Zheng.Guo@walmartlabs.com\",\"displayName\":\"Zheng Guo\"},\"assignee\":{\"key\":\"nramnan\",\"emailAddress\":\"NRamnani@walmart.com\",\"displayName\":\"Neha Ramnani - Vendor\"}}},{\"id\":7371567,\"key\":\"CAREMAIL-7834\",\"fields\":{\"summary\":\"PD Push Relaunch (ios/and)\",\"created\":\"2020-07-06T11:34:24.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"guc000n\",\"emailAddress\":\"Georgina.Clement@walmart.com\",\"displayName\":\"Georgina Clement\"},\"assignee\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"}}},{\"id\":7372111,\"key\":\"CAREMAIL-7835\",\"fields\":{\"summary\":\"Pause all campaigns for Black Out Movement\",\"created\":\"2020-07-06T11:55:39.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"vn502ln\",\"emailAddress\":\"Paul.Chumak@walmart.com\",\"displayName\":\"Paul Chumak - Vendor\"},\"assignee\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"}}},{\"id\":7372162,\"key\":\"CAREMAIL-7836\",\"fields\":{\"summary\":\"Pause NML Messages\",\"created\":\"2020-07-06T12:14:50.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"vn502ln\",\"emailAddress\":\"Paul.Chumak@walmart.com\",\"displayName\":\"Paul Chumak - Vendor\"},\"assignee\":{\"key\":\"vbalag2\",\"emailAddress\":\"VBalaganur@walmart.com\",\"displayName\":\"Veeresh Balaganur - Vendor\"}}},{\"id\":7372193,\"key\":\"CAREMAIL-7839\",\"fields\":{\"summary\":\"Pausing Triggers for Black Out Tuesday\",\"created\":\"2020-07-06T12:25:17.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"vn502ln\",\"emailAddress\":\"Paul.Chumak@walmart.com\",\"displayName\":\"Paul Chumak - Vendor\"},\"assignee\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"}}},{\"id\":7372249,\"key\":\"CAREMAIL-7837\",\"fields\":{\"summary\":\"Sends NML Messages from Tue Jul 7, 2020 on Jul 8, 2020\",\"created\":\"2020-07-06T12:19:30.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"vbalag2\",\"emailAddress\":\"VBalaganur@walmart.com\",\"displayName\":\"Veeresh Balaganur - Vendor\"},\"assignee\":{\"key\":\"vbalag2\",\"emailAddress\":\"VBalaganur@walmart.com\",\"displayName\":\"Veeresh Balaganur - Vendor\"}}},{\"id\":7372405,\"key\":\"CAREMAIL-7838\",\"fields\":{\"summary\":\"Blackout day for Campaigns on Tuesday 07/07\",\"created\":\"2020-07-06T12:20:04.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"},\"assignee\":{\"key\":\"nramnan\",\"emailAddress\":\"NRamnani@walmart.com\",\"displayName\":\"Neha Ramnani - Vendor\"}}},{\"id\":7372691,\"key\":\"CAREMAIL-7840\",\"fields\":{\"summary\":\"Pause NML segment generation for tomorrow\",\"created\":\"2020-07-06T13:16:42.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"vbalag2\",\"emailAddress\":\"VBalaganur@walmart.com\",\"displayName\":\"Veeresh Balaganur - Vendor\"},\"assignee\":{\"key\":\"vbalag2\",\"emailAddress\":\"VBalaganur@walmart.com\",\"displayName\":\"Veeresh Balaganur - Vendor\"}}},{\"id\":7374184,\"key\":\"CAREMAIL-7841\",\"fields\":{\"summary\":\"Campaign Metadata - braze_campaign_canvas_metadata.sh 2\",\"created\":\"2020-07-06T15:07:12.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"asingh\",\"emailAddress\":\"ArjunSingh@walmartlabs.com\",\"displayName\":\"Arjun Bir Singh\"},\"assignee\":{\"key\":\"ariyaz\",\"emailAddress\":\"ARiyaz@walmart.com\",\"displayName\":\"Atheeq Riyaz - Vendor\"}}},{\"id\":7386230,\"key\":\"CAREMAIL-7842\",\"fields\":{\"summary\":\"Fix vulnerabilities in CCM for connectedApi and template-service\",\"created\":\"2020-07-07T14:49:14.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"mvu15\",\"emailAddress\":\"MVu@walmartlabs.com\",\"displayName\":\"Mac Vu\"},\"assignee\":{\"key\":\"mvu15\",\"emailAddress\":\"MVu@walmartlabs.com\",\"displayName\":\"Mac Vu\"}}},{\"id\":7387293,\"key\":\"CAREMAIL-7843\",\"fields\":{\"summary\":\"Deep link test for w+ campaign\",\"created\":\"2020-07-07T17:53:37.000-0700\",\"status\":{\"name\":\"Done\"},\"reporter\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"},\"assignee\":{\"key\":\"r0z00t0\",\"emailAddress\":\"Raymond.Su@walmartlabs.com\",\"displayName\":\"Raymond Su\"}}},{\"id\":7394564,\"key\":\"CAREMAIL-7844\",\"fields\":{\"summary\":\"Decommission emlclk.walmart.com\",\"created\":\"2020-07-08T11:06:08.000-0700\",\"status\":{\"name\":\"Work in Progress\"},\"reporter\":{\"key\":\"mvu15\",\"emailAddress\":\"MVu@walmartlabs.com\",\"displayName\":\"Mac Vu\"},\"assignee\":{\"key\":\"mvu15\",\"emailAddress\":\"MVu@walmartlabs.com\",\"displayName\":\"Mac Vu\"}}},{\"id\":7395388,\"key\":\"CAREMAIL-7845\",\"fields\":{\"summary\":\"OG campaign link opening in browser instead of walmart app (Android)\",\"created\":\"2020-07-08T12:15:46.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"amuthu1\",\"emailAddress\":\"AMuthuvel@walmart.com\",\"displayName\":\"Abiramavalli Muthuvel\"},\"assignee\":{\"key\":\"anauti2\",\"emailAddress\":\"ANautiyal0@walmartlabs.com\",\"displayName\":\"Arun Nautiyal\"}}},{\"id\":7397629,\"key\":\"CAREMAIL-7846\",\"fields\":{\"summary\":\"Go thru the ADID doc and resolve ADID conflicts\",\"created\":\"2020-07-08T15:50:11.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"mvu15\",\"emailAddress\":\"MVu@walmartlabs.com\",\"displayName\":\"Mac Vu\"},\"assignee\":{\"key\":\"mvu15\",\"emailAddress\":\"MVu@walmartlabs.com\",\"displayName\":\"Mac Vu\"}}},{\"id\":7399416,\"key\":\"CAREMAIL-7848\",\"fields\":{\"summary\":\"Batch API Load data from ES to My/SQL\",\"created\":\"2020-07-08T18:48:12.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"},\"assignee\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"}}},{\"id\":7399417,\"key\":\"CAREMAIL-7849\",\"fields\":{\"summary\":\"Alerts on Issues reported from Connected content on Starlink reports\",\"created\":\"2020-07-08T18:49:32.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"},\"assignee\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"}}},{\"id\":7399423,\"key\":\"CAREMAIL-7850\",\"fields\":{\"summary\":\"Based on 'Stopped' Tag Update Campaign, Canvas Metadata\",\"created\":\"2020-07-08T18:52:34.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"},\"assignee\":{\"key\":\"nmittal\",\"emailAddress\":\"nmittal@walmartlabs.com\",\"displayName\":\"Namrita Mittal\"}}},{\"id\":7399524,\"key\":\"CAREMAIL-7847\",\"fields\":{\"summary\":\"GO Email Campaigns data missing\",\"created\":\"2020-07-08T18:46:55.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"vn0cfpa\",\"emailAddress\":\"Manish.Keshari@walmartlabs.com\",\"displayName\":\"Manish Keshari - Vendor\"},\"assignee\":{\"key\":\"anauti2\",\"emailAddress\":\"ANautiyal0@walmartlabs.com\",\"displayName\":\"Arun Nautiyal\"}}},{\"id\":7412558,\"key\":\"CAREMAIL-7851\",\"fields\":{\"summary\":\"Universal Banner Content Block for Triggers\",\"created\":\"2020-07-10T06:56:36.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"vn502ln\",\"emailAddress\":\"Paul.Chumak@walmart.com\",\"displayName\":\"Paul Chumak - Vendor\"},\"assignee\":{\"key\":\"mvu15\",\"emailAddress\":\"MVu@walmartlabs.com\",\"displayName\":\"Mac Vu\"}}},{\"id\":7414748,\"key\":\"CAREMAIL-7852\",\"fields\":{\"summary\":\"Segment Issue Reported\",\"created\":\"2020-07-10T08:52:30.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"nalimal\",\"emailAddress\":\"NAlimallick@walmartlabs.com\",\"displayName\":\"Neakbar Ali Mallick - Vendor\"},\"assignee\":{\"key\":\"nalimal\",\"emailAddress\":\"NAlimallick@walmartlabs.com\",\"displayName\":\"Neakbar Ali Mallick - Vendor\"}}},{\"id\":7415514,\"key\":\"CAREMAIL-7853\",\"fields\":{\"summary\":\"Segment Issue Reported\",\"created\":\"2020-07-10T10:00:34.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"nalimal\",\"emailAddress\":\"NAlimallick@walmartlabs.com\",\"displayName\":\"Neakbar Ali Mallick - Vendor\"},\"assignee\":{\"key\":\"nalimal\",\"emailAddress\":\"NAlimallick@walmartlabs.com\",\"displayName\":\"Neakbar Ali Mallick - Vendor\"}}},{\"id\":7419742,\"key\":\"CAREMAIL-7854\",\"fields\":{\"summary\":\"CLONE - Segment Issue Reported\",\"created\":\"2020-07-11T08:42:46.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"nalimal\",\"emailAddress\":\"NAlimallick@walmartlabs.com\",\"displayName\":\"Neakbar Ali Mallick - Vendor\"},\"assignee\":{\"key\":\"nalimal\",\"emailAddress\":\"NAlimallick@walmartlabs.com\",\"displayName\":\"Neakbar Ali Mallick - Vendor\"}}},{\"id\":7419744,\"key\":\"CAREMAIL-7855\",\"fields\":{\"summary\":\"Segment Issue Reported\",\"created\":\"2020-07-11T08:50:34.000-0700\",\"status\":{\"name\":\"Backlog\"},\"reporter\":{\"key\":\"nalimal\",\"emailAddress\":\"NAlimallick@walmartlabs.com\",\"displayName\":\"Neakbar Ali Mallick - Vendor\"},\"assignee\":{\"key\":\"nalimal\",\"emailAddress\":\"NAlimallick@walmartlabs.com\",\"displayName\":\"Neakbar Ali Mallick - Vendor\"}}}]\n" + 
//    			"\n" + 
//    			"";
//    	int x =0;
//    	for (int i = 0; i < str.length(); i++) {
//			if (str.charAt(i)=='[') {
//				x = i;
//				break;
//			}
//		}
//    	StringBuffer sb = new StringBuffer();
//    	for (int i = x; i < str.length(); i++) {
//			sb.append(str.charAt(i));
//		}
//    	String newStr = sb.toString();
//    	System.out.println("***");
//    	System.out.println(sb);
    	
    	ObjectMapper mapper = new ObjectMapper();
		TypeReference<List<User>> typeReference = new TypeReference<List<User>>(){};
		
		InputStream inputStream = new ByteArrayInputStream(str.getBytes());
    
		try {
			List<User> users = mapper.readValue(inputStream,typeReference);
			userService.save(users);
			System.out.println("Users Saved!");
		} catch (IOException e){
			System.out.println("Unable to save users: " + e.getMessage());
		}
        return userService.list();
    }
    
    @RequestMapping(value = "issue/{key}")
    public String issue(@PathVariable String key) {
    	String jSessionID = jiraService.apiCall();
    	return jiraService.getJsonIssue(jSessionID, key);
    }
}
